<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ToDo Site </title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/x-icon" href="res/icon.png"> 
</head>
<body>
    <main>
    <!-- render user login and registration interface -->

    <div id="userMgmt">

        <!-- user login -->
        <div id="loginHeader">
            <h1> Login </h1>
        </div>
        <div id="userFormLogin">
            <form method="POST">
                <div class="usernameField">
                    <p><label for="id_username" id="id_unametitle">Username</label></p>
                    <p><input type="text" name="username" id="id_username" placeholder="Enter username..."></p>
                </div>
                
                <div id="passwordField">
                    <p><label for="id_password" id="id_pwdtitle">Password</label></p>
                    <p><input type="password" name="password" id="id_password" placeholder="Enter password..."></p>
                </div>

                <input type="checkbox" name="remember_me" id="id_remember_me">
                <label for="id_remember_me" id="id_remember_me_text">Remember me</label>
                <a href="#" id="showReg" style="font-size: 16px;">Create new account</a>
                <p><input type="submit" name="loginbtn" id="id_loginbtn" value="Login"></p>

                <!-- Register/Login with Google -->
                <p>
                    <button class="googleRegBtn">
                        <img src="res/google.png" alt="[Google]" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 5px;">
                        Login with Google
                    </button>
                </p>

            </form>
        </div>

        <!-- user registration -->
        <div id="registrationHeader">
            <h1> Register </h1>
        </div>
        <div id="userFormReg">
            <form method="POST">
                <div class="usernameField">
                    <p><label for="id_usernameReg" id="id_unametitle">Username</label></p>
                    <p><input type="text" name="username" id="id_usernameReg" placeholder="Enter username..."></p>
                </div>
                
                <div id="passwordField1">
                    <p><label for="id_password1" id="id_pwdtitle1">Password</label></p>
                    <p><input type="password" name="password1" id="id_password1" placeholder="Enter password..."></p>
                </div>

                <div id="passwordField2">
                    <p><label for="id_password2" id="id_pwdtitle2">Confirm password</label></p>
                    <p><input type="password" name="password2" id="id_password2" placeholder="Enter password..."></p>
                </div>

                <div id="emailField">
                    <p><label for="id_email" id="id_emailTitle">Email</label></p>
                    <p><input type="email" name="email" id="id_email" placeholder="Enter email..."></p>
                </div>
                <a href="#" id="showLogin" style="font-size: 16px;"> Already have an account? </a>
                <p><input type="submit" name="regbtn" id="id_regbtn" value="Register"></p>

                <!-- Register/Login with Google -->
                <p>
                    <button class="googleRegBtn">
                        <img src="res/google.png" alt="[Google]" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 5px;">
                        Registration with Google
                    </button>
                </p>

            </form>
        </div>

    </div>

    <!-- render the task webapp itself -->

    <div id="tasksbox">
        <button id="userlogout">Logout</button>
        <div id="titleHeader">
            <h1>Add tasks to do</h1>
        </div>

        <!-- Create Task -->
        <div id="tasksform">
            <form method="POST">
                <p>
                    <input type="text" name="tasksTitle" id="id_tasksTitle" placeholder="Task title" required>
                    <input type="submit" name="taskAdd" id="id_taskAdd" value="Add task">
                </p>  
                <p><textarea name="tasksDescrp" id="id_tasksDescrp" cols="30" rows="3" placeholder="Description (optional)"></textarea></p>
            </form>
        </div>

        <!-- Show Tasks -->
        <div class="taskslist">
                <ul id="tasklist" style="list-style: none;">
                    <!-- code pushed by JS -->
                </ul>
        </div>

        <!-- task popup to show details -->
        <div id="taskPopup" class="popup hidden">
            <div class="popup-header">
                <h2 id="popupTitle"></h2>
                <span id="popupCreationTime"></span>
                <button id="popupCloseBtn"> <b>X</b></button>
            </div>
            <div class="popup-body">
                <textarea id="popupDetail" readonly></textarea>
            </div>
        </div>

        <!-- custom notification -->
        <div id="customNotif" class="custom-notif hidden">
            <span id="notification"></span>
            <button id="OKbtn">OK</button>
        </div>

    </div>

    </main>

    <script src="js/main.js"></script>
    <script src="js/notification.js"></script>
    <script src="js/timefmt.js"></script>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const access = localStorage.getItem('access');
            const refresh = localStorage.getItem('refresh');

            if(access && refresh)
            {
                showTaskPage();
            }
            else 
            {
                showLoginPage();
            }
        });

        function showTaskPage() 
        {
            document.getElementById("loginHeader").style.display = "none";
            document.getElementById("userFormLogin").style.display = "none";
            document.getElementById("registrationHeader").style.display = "none";
            document.getElementById("userFormReg").style.display = "none";
            userMgmtInterface.style.display = "none";
            taskCotainer.style.display = "block";
            loadTasksList();
        }

        function showLoginPage() 
        {
            document.getElementById("loginHeader").style.display = "block";
            document.getElementById("userFormLogin").style.display = "block";
            document.getElementById("registrationHeader").style.display = "none";
            document.getElementById("userFormReg").style.display = "none";
            taskCotainer.style.display = "none";
        }

    </script>
</body>
</html>